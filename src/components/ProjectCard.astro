---
import { type CollectionEntry } from 'astro:content';
import { getRelativeLocaleUrl } from 'astro:i18n';
import { type Lang, defaultLang } from '@i18n/ui';
import { useTranslations } from '@i18n/utils';

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const currentLang = (Astro.currentLocale || defaultLang) as Lang;
const t = useTranslations(currentLang);

const cleanSlug = project.slug.replace(/^[a-z]{2}\//, '');
const projectUrl = getRelativeLocaleUrl(currentLang, `projects/${cleanSlug}`);
---

<a
  href={projectUrl}
  class="group relative block w-full h-full overflow-hidden rounded-xl bg-base-200 border border-base-300 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 hover:border-primary/50"
  data-category={project.data.category}
>
  {/* Image Section with Zoom Effect */}
  <div class="aspect-video w-full overflow-hidden bg-base-300 relative">
    {
      project.data.image ? (
        <img
          src={project.data.image}
          alt={project.data.title}
          class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
        />
      ) : (
        <div class="flex h-full w-full items-center justify-center bg-base-200 text-base-content/20">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <>
              <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
              <circle cx="9" cy="9" r="2" />
              <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
            </>
          </svg>
        </div>
      )
    }

    {/* Overlay Category Badge */}
    <div class="absolute top-3 right-3">
      <span
        class="badge badge-sm backdrop-blur-md bg-base-100/80 border-0 shadow-sm capitalize font-bold"
      >
        {t(`projects.filter.${project.data.category}` as any)}
      </span>
    </div>
  </div>

  {/* Content Section */}
  <div class="p-5 flex flex-col gap-3">
    <h3 class="text-xl font-bold leading-tight group-hover:text-primary transition-colors">
      {project.data.title}
    </h3>

    <p class="text-sm opacity-70 line-clamp-2">
      {project.data.description}
    </p>

    {/* Tags */}
    <div class="flex flex-wrap gap-2 mt-auto pt-2">
      {
        project.data.tags
          .slice(0, 3)
          .map((tag) => <span class="badge badge-outline badge-xs opacity-70">{tag}</span>)
      }
      {
        project.data.tags.length > 3 && (
          <span class="text-xs opacity-50">+{project.data.tags.length - 3}</span>
        )
      }
    </div>
  </div>
</a>
